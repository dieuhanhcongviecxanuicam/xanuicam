name: Secret manager examples (template)

on:
  workflow_dispatch:

jobs:
  hashicorp-vault-example:
    name: Fetch secrets from HashiCorp Vault (example)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Authenticate to Vault (example using AppRole)
        uses: hashicorp/vault-action@v2
        with:
          url: ${{ secrets.VAULT_ADDR }}
          method: approle
          roleId: ${{ secrets.VAULT_ROLE_ID }}
          secretId: ${{ secrets.VAULT_SECRET_ID }}

      - name: Read DB password from Vault and expose as env
        run: |
          PASSWORD=$(vault kv get -field=password secret/data/ubndx)
          echo "DB_PASSWORD=$PASSWORD" >> $GITHUB_ENV

      - name: Show placeholder
        run: echo "Fetched DB_PASSWORD from Vault and set as env for downstream steps (masked)."

  azure-key-vault-example:
    name: Fetch secrets from Azure Key Vault (example)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get secrets from Azure Key Vault
        uses: azure/get-keyvault-secrets@v1
        with:
          keyvault: ${{ secrets.AZURE_KEYVAULT_NAME }}
          secrets: 'DB_PASSWORD,JWT_SECRET'

      - name: Print note
        run: echo "Secrets from Azure Key Vault are available to the workflow as env variables (do not print them)."

# Notes:
# - These are example workflows. To use them, add the required secrets (VAULT_ADDR,
#   VAULT_ROLE_ID, VAULT_SECRET_ID, AZURE_KEYVAULT_NAME, etc.) to the repository
#   or organization secrets and adjust secret paths as required.